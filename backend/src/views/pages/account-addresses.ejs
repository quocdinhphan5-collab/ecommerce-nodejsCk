<%- include('../partials/header', { title }) %>

<div class="container py-4">

  <h1 class="h4 mb-3 text-primary fw-bold">üìç ƒê·ªãa ch·ªâ giao h√†ng</h1>

  <% if (error) { %>
    <div class="alert alert-danger"><%= error %></div>
  <% } %>
  <% if (success) { %>
    <div class="alert alert-success"><%= success %></div>
  <% } %>

  <!-- DANH S√ÅCH ƒê·ªäA CH·ªà -->
  <div class="mb-4">
    <h2 class="h5 mb-3">ƒê·ªãa ch·ªâ ƒë√£ l∆∞u</h2>

    <div class="row">
      <% if (user.addresses && user.addresses.length > 0) { %>
        <% user.addresses.forEach(function(addr) { %>
          <div class="col-md-6 mb-3">
            <div class="card border-0 shadow-sm h-100">
              <div class="card-body">
                <h5 class="card-title mb-1 d-flex align-items-center justify-content-between">
                  <span><%= addr.fullName %></span>
                  <% if (addr.isDefault) { %>
                    <span class="badge bg-success">M·∫∑c ƒë·ªãnh</span>
                  <% } %>
                </h5>
                <p class="mb-1 small text-muted">
                  ƒêi·ªán tho·∫°i: <strong><%= addr.phone %></strong>
                </p>
                <p class="mb-2 small text-muted">
                  <%= addr.street %>, <%= addr.ward %>, <%= addr.district %>, <%= addr.province %>
                </p>

                <hr class="my-2">

                <!-- Form s·ª≠a ƒë·ªãa ch·ªâ -->
                <form method="post" action="/account/addresses/<%= addr._id %>/update" class="mt-2">
                  <div class="mb-1">
                    <input
                      type="text"
                      name="fullName"
                      class="form-control form-control-sm"
                      value="<%= addr.fullName %>"
                      placeholder="H·ªç t√™n ng∆∞·ªùi nh·∫≠n"
                    >
                  </div>
                  <div class="mb-1">
                    <input
                      type="text"
                      name="phone"
                      class="form-control form-control-sm"
                      value="<%= addr.phone %>"
                      placeholder="S·ªë ƒëi·ªán tho·∫°i"
                    >
                  </div>
                  <div class="mb-1">
                    <input
                      type="text"
                      name="province"
                      class="form-control form-control-sm"
                      value="<%= addr.province %>"
                      placeholder="T·ªânh/Th√†nh"
                    >
                  </div>
                  <div class="mb-1">
                    <input
                      type="text"
                      name="district"
                      class="form-control form-control-sm"
                      value="<%= addr.district %>"
                      placeholder="Qu·∫≠n/Huy·ªán"
                    >
                  </div>
                  <div class="mb-1">
                    <input
                      type="text"
                      name="ward"
                      class="form-control form-control-sm"
                      value="<%= addr.ward %>"
                      placeholder="Ph∆∞·ªùng/X√£"
                    >
                  </div>
                  <div class="mb-1">
                    <input
                      type="text"
                      name="street"
                      class="form-control form-control-sm"
                      value="<%= addr.street %>"
                      placeholder="ƒê·ªãa ch·ªâ chi ti·∫øt"
                    >
                  </div>

                  <div class="form-check mb-2">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      name="isDefault"
                      id="def-<%= addr._id %>"
                      <%= addr.isDefault ? 'checked' : '' %>
                    >
                    <label class="form-check-label small" for="def-<%= addr._id %>">
                      ƒê·∫∑t l√†m ƒë·ªãa ch·ªâ m·∫∑c ƒë·ªãnh
                    </label>
                  </div>

                  <div class="d-flex justify-content-between align-items-center mt-2">
                    <button class="btn btn-sm btn-primary" type="submit">
                      L∆∞u thay ƒë·ªïi
                    </button>

                    <form
                      method="post"
                      action="/account/addresses/<%= addr._id %>/delete"
                      class="d-inline"
                      onsubmit="return confirm('B·∫°n ch·∫Øc ch·∫Øn x√≥a ƒë·ªãa ch·ªâ n√†y?');"
                    >
                      <button class="btn btn-sm btn-outline-danger" type="submit">
                        X√≥a
                      </button>
                    </form>
                  </div>
                </form>

              </div>
            </div>
          </div>
        <% }) %>
      <% } else { %>
        <div class="col-12">
          <div class="alert alert-info mb-0">
            Ch∆∞a c√≥ ƒë·ªãa ch·ªâ n√†o. H√£y th√™m ƒë·ªãa ch·ªâ m·ªõi b√™n d∆∞·ªõi.
          </div>
        </div>
      <% } %>
    </div>
  </div>

  <hr>

  <!-- Form th√™m ƒë·ªãa ch·ªâ m·ªõi -->
  <% if (!user.addresses || user.addresses.length < 3) { %>
    <div class="mt-4 mb-4">
      <h2 class="h5 mb-3">Th√™m ƒë·ªãa ch·ªâ m·ªõi <small class="text-muted">(t·ªëi ƒëa 3 ƒë·ªãa ch·ªâ)</small></h2>

      <div class="card border-0 shadow-sm">
        <div class="card-body">
          <form method="post" action="/account/addresses" class="row g-2">
            <div class="col-md-6">
              <label class="form-label">H·ªç t√™n ng∆∞·ªùi nh·∫≠n</label>
              <input
                type="text"
                name="fullName"
                class="form-control"
                value="<%= user.fullName %>"
                required
              >
            </div>
            <div class="col-md-6">
              <label class="form-label">S·ªë ƒëi·ªán tho·∫°i</label>
              <input
                type="text"
                name="phone"
                class="form-control"
                required
              >
            </div>

            <div class="col-md-3">
              <label class="form-label">T·ªânh/Th√†nh</label>
              <input
                type="text"
                name="province"
                class="form-control"
                required
              >
            </div>
            <div class="col-md-3">
              <label class="form-label">Qu·∫≠n/Huy·ªán</label>
              <input
                type="text"
                name="district"
                class="form-control"
                required
              >
            </div>
            <div class="col-md-3">
              <label class="form-label">Ph∆∞·ªùng/X√£</label>
              <input
                type="text"
                name="ward"
                class="form-control"
                required
              >
            </div>
            <div class="col-md-9">
              <label class="form-label">ƒê·ªãa ch·ªâ chi ti·∫øt</label>
              <input
                type="text"
                name="street"
                class="form-control"
                placeholder="S·ªë nh√†, t√™n ƒë∆∞·ªùng..."
                required
              >
            </div>

            <div class="col-md-3 d-flex align-items-end">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  name="isDefault"
                  id="isDefault"
                >
                <label class="form-check-label" for="isDefault">
                  ƒê·∫∑t l√†m m·∫∑c ƒë·ªãnh
                </label>
              </div>
            </div>

            <div class="col-12 mt-2">
              <button type="submit" class="btn btn-primary">
                L∆∞u ƒë·ªãa ch·ªâ
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  <% } else { %>
    <p class="text-muted mt-3">
      B·∫°n ƒë√£ l∆∞u <strong>3 ƒë·ªãa ch·ªâ giao h√†ng</strong>.  
      N·∫øu mu·ªën th√™m ƒë·ªãa ch·ªâ kh√°c, h√£y <strong>s·ª≠a</strong> m·ªôt ƒë·ªãa ch·ªâ ho·∫∑c <strong>x√≥a</strong> b·ªõt.
    </p>
  <% } %>

</div>

<%- include('../partials/footer') %>
