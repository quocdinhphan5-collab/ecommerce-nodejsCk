<link rel="stylesheet" href="/css/auth.css">

<%- include('../partials/header', { title: 'Nháº­p mÃ£ xÃ¡c nháº­n' }) %>

<div class="container py-4 d-flex justify-content-center">
  <div class="col-md-6 col-lg-5">
    <div class="card border-0 shadow-sm mb-3">
      <div class="card-body">
        <h1 class="h4 mb-3 text-primary fw-bold">ğŸ” XÃ¡c minh mÃ£ OTP</h1>

        <% if (error) { %>
          <div class="alert alert-danger"><%= error %></div>
        <% } %>
        <% if (message) { %>
          <div class="alert alert-success"><%= message %></div>
        <% } %>

        <!-- FORM OTP -->
        <form method="post" action="/new-password" class="mb-3">
          <input type="hidden" name="email" value="<%= email %>">

          <label class="form-label">Nháº­p mÃ£ OTP</label>
          <input
            type="text"
            name="code"
            class="form-control otp-input"
            maxlength="6"
            placeholder="Nháº­p mÃ£ 6 sá»‘"
            required
          >

          <button class="btn btn-primary w-100 mt-3">XÃ¡c nháº­n</button>
        </form>

        <!-- FORM gá»­i láº¡i mÃ£ -->
        <form method="post" action="/new-password/resend">
          <input type="hidden" name="email" value="<%= email %>">

          <!-- KHÃ”NG disabled vÃ  KHÃ”NG Ä‘áº¿m ngÆ°á»£c khi má»›i load -->
          <button id="resendBtn" class="btn btn-outline-secondary w-100">
            Gá»­i láº¡i mÃ£
          </button>
        </form>

        <p class="mt-3 text-center small">
          <a href="/forgot-password">Quay láº¡i trang quÃªn máº­t kháº©u</a>
        </p>

      </div>
    </div>
  </div>
</div>

<script>
  (function () {
    const COOLDOWN = 60; // 60s = 1 phÃºt. Náº¿u muá»‘n 30s thÃ¬ Ä‘á»•i thÃ nh 30.
    const resendBtn = document.getElementById('resendBtn');
    if (!resendBtn) return;

    let remaining = 0;
    let timerId = null;

    function startCountdown() {
      remaining = COOLDOWN;
      resendBtn.disabled = true;
      resendBtn.textContent = `Gá»­i láº¡i mÃ£ (${remaining}s)`;

      timerId = setInterval(() => {
        remaining -= 1;
        if (remaining > 0) {
          resendBtn.textContent = `Gá»­i láº¡i mÃ£ (${remaining}s)`;
        } else {
          clearInterval(timerId);
          timerId = null;
          resendBtn.disabled = false;
          resendBtn.textContent = 'Gá»­i láº¡i mÃ£';
        }
      }, 1000);
    }

    // Chá»‰ khi báº¥m nÃºt má»›i báº¯t Ä‘áº§u Ä‘áº¿m ngÆ°á»£c
    resendBtn.addEventListener('click', function (e) {
      // Náº¿u Ä‘ang Ä‘áº¿m rá»“i thÃ¬ cháº·n khÃ´ng cho submit tiáº¿p
      if (timerId) {
        e.preventDefault();
        return;
      }
      // Báº¯t Ä‘áº§u Ä‘áº¿m ngÆ°á»£c vÃ  váº«n cho form submit Ä‘á»ƒ gá»­i mail
      startCountdown();
    });
  })();
</script>

<%- include('../partials/footer') %>
