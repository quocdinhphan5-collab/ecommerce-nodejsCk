<%- include('../partials/header') %>

<h1>Quản lý sản phẩm</h1>

<div class="d-flex justify-content-between align-items-center mb-3">
  <form class="d-flex" method="get" action="/admin/products">
    <input
      type="text"
      name="q"
      class="form-control me-2"
      placeholder="Tìm theo tên"
      value="<%= (query && query.q) || '' %>"
    >
    <input
      type="text"
      name="category"
      class="form-control me-2"
      placeholder="Danh mục"
      value="<%= (query && query.category) || '' %>"
    >
    <button class="btn btn-outline-primary">Lọc</button>
  </form>

  <a href="/admin/products/new" class="btn btn-primary">
    Thêm sản phẩm
  </a>
</div>

<table class="table table-striped">
  <thead>
    <tr>
      <th>Tên sản phẩm</th>
      <th>Danh mục</th>
      <th>Giá (₫)</th>
      <th>Tồn kho</th>
      <th>Ngày tạo</th>
      <th class="text-end">Thao tác</th>
    </tr>
  </thead>
  <tbody>
    <% if (!products || !products.length) { %>
      <tr>
        <td colspan="6" class="text-center">Chưa có sản phẩm</td>
      </tr>
    <% } else { %>
      <% products.forEach(function (p) { %>
        <tr>
          <td><%= p.name %></td>
          <td><%= p.category || '-' %></td>
          <td><%= (p.price || 0).toLocaleString('vi-VN') %></td>
          <td><%= (p.stock != null ? p.stock : 0) %></td>
          <td>
            <%= p.createdAt
                  ? p.createdAt.toLocaleDateString('vi-VN')
                  : '' %>
          </td>
          <td class="text-end">
            <a
              href="/admin/products/<%= p._id %>/edit"
              class="btn btn-sm btn-outline-secondary me-1"
            >
              Sửa
            </a>
            <form
              method="post"
              action="/admin/products/<%= p._id %>/delete"
              style="display:inline-block"
              onsubmit="return confirm('Xóa sản phẩm này?');"
            >
              <button class="btn btn-sm btn-outline-danger">
                Xóa
              </button>
            </form>
          </td>
        </tr>
      <% }) %>
    <% } %>
  </tbody>
</table>

<%- include('../partials/footer') %>
